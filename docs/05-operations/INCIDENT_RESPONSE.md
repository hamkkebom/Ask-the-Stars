# 🚨 장애 대응 매뉴얼 (Incident Response)

> **우선순위**: 장애 발생 시 이 문서를 최우선으로 따릅니다.

---

## 1. 장애 등급 판단

| 등급 | 상황 | 예시 | 대응 목표 |
|------|------|------|----------|
| **P1 (Critical)** | 서비스 전체 중단 | 접속 불가, 로그인 불가, 결제/정산 오류 | **1시간 내 정상화** |
| **P2 (High)** | 주요 기능 오작동 | 영상 업로드 실패, 알림 미발송 | **4시간 내 해결** |
| **P3 (Medium)** | 일부 불편 | CSS 깨짐, 간헐적 느림, 오타 | **24시간 내 해결** |
| **P4 (Low)** | 내부/관리자 불편 | 통계 대시보드 오류 | **다음 스프린트** |

---

## 2. 대응 절차 (Workflow)

### Step 1: 인지 및 전파
- **알림 채널**: Slack `#im-alerts`, 문자 메시지
- **액션**:
    - 즉시 `#im-war-room` 채널 생성
    - 관련 담당자(Tech Lead, Infra, Backend) 소집
    - 사용자 공지 게시 (상태 페이지 업데이트)

### Step 2: 원인 파악 (Triaging)
1. **Frontend 문제?** -> Vercel 배포 롤백 (`vercel rollback`)
2. **Backend 문제?** -> Sentry 로그 확인, Cloud Run 상태 확인
3. **DB 문제?** -> Supabase Connection 확인, Lock 확인

### Step 3: 조치 및 복구
- **핫픽스 배포**: 긴급 수정이 필요한 경우 `hotfix/` 브랜치 생성 후 배포
- **인프라 증설 (Scale-up)**: 트래픽 폭주 시 Cloud Run 최대 인스턴스 수 증가

### Step 4: 사후 분석 (Post-Mortem)
- 장애 종료 후 24시간 이내 작성
- 포함 내용:
    - 장애 발생 시간 및 지속 시간
    - 근본 원인 (Root Cause)
    - 타임라인별 조치 내용
    - 재발 방지 대책 (Action Items)

---

## 3. 주요 장애별 체크리스트

### ⚠️ "사이트에 접속이 안 돼요" (500/502/504 Error)
- [ ] **Vercel Status** 확인 (Vercel 자체 장애 여부)
- [ ] **Cloud Run** 인스턴스가 정상 작동 중인지 확인 (Crash Loop 여부)
- [ ] **도메인 DNS** 설정 변경 여부 확인

### ⚠️ "로그인이 안 돼요"
- [ ] **AuthService** 로그 확인 (Argon2 해시 불일치? 토큰 만료?)
- [ ] **Supabase** DB 연결 상태 확인
- [ ] 클라이언트와 서버 시간 동기화 확인 (JWT 만료 문제)

### ⚠️ "업로드가 계속 실패해요"
- [ ] **AWS S3** 버킷 권한(Policy) 변경 여부 확인
- [ ] 파일 용량 제한(50MB) 초과 여부 확인
- [ ] 서버 디스크 공간 부족 여부 (Cloud Run은 메모리 기반 파일 시스템 주의)
